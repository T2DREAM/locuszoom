!function() {
    try {

        // Verify that the two third-party dependencies are met: d3 and Q
        var minimum_d3_version = "3.5.6";
        if (typeof d3 != "object"){
            throw("LocusZoom unable to load: d3 dependency not met. Library missing.");
        } else if (d3.version < minimum_d3_version){
            throw("LocusZoom unable to load: d3 dependency not met. Outdated version detected.\nRequired d3 version: " + minimum_d3_version + " or higher (found: " + d3.version + ").");
        }
        if (typeof Q != "function"){
            throw("LocusZoom unable to load: Q dependency not met. Library missing.");
        }
        
        var LocusZoom={version:"0.3.2"};LocusZoom.addInstanceToDivById=function(o,e,t,n){var i=new LocusZoom.Instance(o,e,t,n);if(i.svg=d3.select("div#"+o).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg").attr("id",o+"_svg").attr("class","lz-locuszoom"),i.setDimensions(),i.initialize(),"undefined"!=typeof i.svg.node().parentNode.dataset&&"undefined"!=typeof i.svg.node().parentNode.dataset.region){var a=i.svg.node().parentNode.dataset.region.split(/\D/);i.mapTo(+a[0],+a[1],+a[2])}return i},LocusZoom.populate=function(o,e,t,n){if("undefined"==typeof o)throw"LocusZoom.populate selector not defined";var i;return d3.select(o).each(function(){i=LocusZoom.addInstanceToDivById(this.id,e,t,n)}),i},LocusZoom.populateAll=function(o,e,t,n){var i=[];return d3.selectAll(o).each(function(o,a){i[a]=LocusZoom.populate(this,e,t,n)}),i},LocusZoom.positionIntToString=function(o){var e=Math.min(Math.max(6-Math.floor((Math.log(o)/Math.LN10).toFixed(9)),2),12);return""+(o/Math.pow(10,6)).toFixed(e)},LocusZoom.positionStringToInt=function(o){var e=o.toUpperCase();e=e.replace(/,/g,"");var t=/([KMG])[B]*$/,n=t.exec(e),i=1;return n&&(i="M"==n[1]?1e6:"G"==n[1]?1e9:1e3,e=e.replace(t,"")),e=Number(e)*i},LocusZoom.parsePositionQuery=function(o){var e=/^(\w+):([\d,.]+[kmgbKMGB]*)([-+])([\d,.]+[kmgbKMGB]*)$/,t=/^(\w+):([\d,.]+[kmgbKMGB]*)$/,n=e.exec(o);if(n){if("+"==n[3]){var i=LocusZoom.positionStringToInt(n[2]),a=LocusZoom.positionStringToInt(n[4]);return{chr:n[1],start:i-a,end:i+a}}return{chr:n[1],start:LocusZoom.positionStringToInt(n[2]),end:LocusZoom.positionStringToInt(n[4])}}return n=t.exec(o),n?{chr:n[1],position:LocusZoom.positionStringToInt(n[2])}:null},LocusZoom.prettyTicks=function(o,e,t){("undefined"==typeof t||isNaN(parseInt(t)))&&(t=5),t=parseInt(t);var n=t/3,i=.75,a=1.5,r=.5+1.5*a,s=Math.abs(o[0]-o[1]),u=s/t;Math.log(s)/Math.LN10<-2&&(u=Math.max(Math.abs(s))*i/n);var p=Math.pow(10,Math.floor(Math.log(u)/Math.LN10)),l=0;1>p&&0!=p&&(l=Math.abs(Math.round(Math.log(p)/Math.LN10)));var d=p;a*(u-d)>2*p-u&&(d=2*p,r*(u-d)>5*p-u&&(d=5*p,a*(u-d)>10*p-u&&(d=10*p)));for(var c=[],h=parseFloat((Math.floor(o[0]/d)*d).toFixed(l));h<o[1];)c.push(h),h+=d,l>0&&(h=parseFloat(h.toFixed(l)));return c.push(h),("undefined"==typeof e||-1==["low","high","both","neither"].indexOf(e))&&(e="neither"),("low"==e||"both"==e)&&c[0]<o[0]&&(c=c.slice(1)),("high"==e||"both"==e)&&c[c.length-1]>o[1]&&c.pop(),c},LocusZoom.createCORSPromise=function(o,e,t,n){var i=Q.defer(),a=new XMLHttpRequest;return"withCredentials"in a?a.open(o,e,!0):"undefined"!=typeof XDomainRequest?(a=new XDomainRequest,a.open(o,e)):a=null,a&&(a.onreadystatechange=function(){4===a.readyState&&(200===a.status||0===a.status?i.resolve(JSON.parse(a.responseText)):i.reject("HTTP "+a.status+" for "+e))},n&&setTimeout(i.reject,n),t="undefined"!=typeof t?t:"",a.send(t)),i.promise},LocusZoom.mergeLayouts=function(o,e){if("object"!=typeof o||"object"!=typeof e)throw"LocusZoom.mergeLayouts only accepts two layout objects; "+typeof o+", "+typeof e+" given";for(var t in e)if(e.hasOwnProperty(t)){var n=null==o[t]?"undefined":typeof o[t],i=typeof e[t];if("function"==n||"function"==i)throw"LocusZoom.mergeLayouts encountered an unsupported property type";"undefined"!=n?"object"!=n||"object"!=i||(o[t]=LocusZoom.mergeLayouts(o[t],e[t])):o[t]=JSON.parse(JSON.stringify(e[t]))}return o},LocusZoom.DefaultState={chr:0,start:0,end:0},LocusZoom.DefaultLayout={width:700,height:700,min_width:300,min_height:400,panels:{positions:{origin:{x:0,y:0},width:700,height:350,min_width:300,min_height:200,proportional_width:1,proportional_height:.5,margin:{top:20,right:20,bottom:35,left:50},axes:{x:{label_function:"chromosome"},y1:{label:"-log10 p-value"}},data_layers:{positions:{type:"scatter",point_shape:"circle",point_size:40,point_label_field:"id",fields:["id","position","pvalue|neglog10","refAllele","ld:state"],x_axis:{field:"position"},y_axis:{axis:1,field:"pvalue|neglog10",floor:0,upper_buffer:.05},color:{field:"ld:state",scale_function:"numerical_bin",parameters:{breaks:[0,.2,.4,.6,.8],values:["#357ebd","#46b8da","#5cb85c","#eea236","#d43f3a"],null_value:"#B8B8B8"}}}}},genes:{origin:{x:0,y:350},width:700,height:350,min_width:300,min_height:200,proportional_width:1,proportional_height:.5,margin:{top:20,right:20,bottom:20,left:50},data_layers:{genes:{type:"genes",fields:["gene:gene"]}}}}};
"use strict";LocusZoom.DataSources=function(){this.sources={}},LocusZoom.DataSources.prototype.addSource=function(o,t){function e(o){if(!LocusZoom.KnownDataSources)return null;for(var t=0;t<LocusZoom.KnownDataSources.length;t++){if(!LocusZoom.KnownDataSources[t].SOURCE_NAME)throw"KnownDataSource at position "+t+" does not have a 'SOURCE_NAME' static property";if(LocusZoom.KnownDataSources[t].SOURCE_NAME==o)return LocusZoom.KnownDataSources[t]}return null}if(Array.isArray(t)){var r=e(t[0]);if(!r)throw"Unable to resolve "+t[0]+" data source";this.sources[o]=new r(t[1])}else this.sources[o]=t;return this},LocusZoom.DataSources.prototype.getSource=function(o){return this.sources[o]},LocusZoom.DataSources.prototype.setSources=function(o){"string"==typeof o&&(o=JSON.parse(o));var t=this;return Object.keys(o).forEach(function(e){t.addSource(e,o[e])}),t},LocusZoom.DataSources.prototype.keys=function(){return Object.keys(this.sources)},LocusZoom.DataSources.prototype.toJSON=function(){return this.sources},LocusZoom.Data=LocusZoom.Data||{},LocusZoom.Data.Requester=function(o){function t(o){var t={},e=/^(?:([^:]+):)?([^:\|]*)(\|.+)*$/;return o.forEach(function(o){var r=e.exec(o),n=r[1]||"base",s=r[2],a=LocusZoom.Data.Transformations.get(r[3]);"undefined"==typeof t[n]&&(t[n]={outnames:[],fields:[],trans:[]}),t[n].outnames.push(o),t[n].fields.push(s),t[n].trans.push(a)}),t}this.getData=function(e,r){for(var n=t(r),s=Object.keys(n).map(function(t){if(!o.getSource(t))throw"Datasource for namespace "+t+" not found";return o.getSource(t).getData(e,n[t].fields,n[t].outnames,n[t].trans)}),a=Q.when({header:{},body:{}}),u=0;u<s.length;u++)a=a.then(s[u]);return a}},LocusZoom.Data.Source=function(){},LocusZoom.Data.Source.prototype.parseInit=function(o){if("string"==typeof o?(this.url=o,this.params={}):(this.url=o.url,this.params=o.params||{}),!this.url)throw"Source not initialized with required URL"},LocusZoom.Data.Source.prototype.getRequest=function(o,t,e){return LocusZoom.createCORSPromise("GET",this.getURL(o,t,e))},LocusZoom.Data.Source.prototype.getData=function(o,t,e,r){return function(n){return this.getRequest(o,n,t).then(function(o){return this.parseResponse(o,n,t,e,r)}.bind(this))}.bind(this)},LocusZoom.Data.Source.prototype.toJSON=function(){return[Object.getPrototypeOf(this).constructor.SOURCE_NAME,{url:this.url,params:this.params}]},LocusZoom.Data.AssociationSource=function(o){this.parseInit(o),this.getData=function(o,t,e,r){return["id","position"].forEach(function(o){-1==t.indexOf(o)&&(t.unshift(o),e.unshift(o),r.unshift(null))}),function(n){return this.getRequest(o,n).then(function(o){return this.parseResponse(o,n,t,e,r)}.bind(this))}.bind(this)}},LocusZoom.Data.AssociationSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.AssociationSource.prototype.constructor=LocusZoom.Data.AssociationSource,LocusZoom.Data.AssociationSource.prototype.getURL=function(o,t,e){var r=o.analysis||t.header.analysis||this.params.analysis||3;return this.url+"results/?filter=analysis in "+r+" and chromosome in  '"+o.chr+"' and position ge "+o.start+" and position le "+o.end},LocusZoom.Data.AssociationSource.prototype.parseResponse=function(o,t,e,r,n){var s=o.data,a=[];e.forEach(function(o){if(!(o in s))throw"field "+o+" not found in response"});for(var u=0;u<s.position.length;u++){for(var i={},c=0;c<e.length;c++){var f=s[e[c]][u];n&&n[c]&&(f=n[c](f)),i[r[c]]=f}a.push(i)}var p={header:t.header||{},body:a};return p},LocusZoom.Data.AssociationSource.SOURCE_NAME="AssociationLZ",LocusZoom.Data.LDSource=function(o){this.parseInit(o),this.params.pvaluefield||(this.params.pvaluefield="pvalue|neglog10"),this.getData=function(o,t,e,r){if(t.length>1)throw"LD currently only supports one field";return function(n){return this.getRequest(o,n,t).then(function(o){return this.parseResponse(o,n,t,e,r)}.bind(this))}.bind(this)}},LocusZoom.Data.LDSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.LDSource.prototype.constructor=LocusZoom.Data.LDSource,LocusZoom.Data.LDSource.prototype.getURL=function(o,t,e){var r=function(o,t,e){t=t||"pvalue",e=e||1;for(var r=o[0][t],n=0,s=1;s<o.length;s++)o[s][t]*e>r&&(r=o[s][t]*e,n=s);return n},n=o.ldrefsource||t.header.ldrefsource||1,s=e[0];if("state"==s&&(s=o.ldrefvar||t.header.ldrefvar||"best"),"best"==s){if(!t.body)throw"No association data found to find best pvalue";s=t.body[r(t.body,this.params.pvaluefield)].id}return t.header||(t.header={}),t.header.ldrefvar=s,this.url+"results/?filter=reference eq "+n+" and chromosome2 eq '"+o.chr+"' and position2 ge "+o.start+" and position2 le "+o.end+" and variant1 eq '"+s+"'&fields=chr,pos,rsquare"},LocusZoom.Data.LDSource.prototype.parseResponse=function(o,t,e,r){var n=function(o,t,e,r){for(var n=0,s=0;n<o.length&&s<t.position2.length;)o[n].position==t.position2[s]?(o[n][e]=t[r][s],n++,s++):o[n].position<t.position2[s]?n++:s++};return n(t.body,o.data,r[0],"rsquare"),t},LocusZoom.Data.LDSource.SOURCE_NAME="LDLZ",LocusZoom.Data.GeneSource=function(o){this.parseInit(o),this.getData=function(o,t,e,r){return function(n){return this.getRequest(o,n,t).then(function(o){return this.parseResponse(o,n,t,e,r)}.bind(this))}.bind(this)}},LocusZoom.Data.GeneSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.GeneSource.prototype.constructor=LocusZoom.Data.GeneSource,LocusZoom.Data.GeneSource.prototype.getURL=function(o,t,e){return this.url+"?filter=source in 1 and chrom eq '"+o.chr+"' and start le "+o.end+" and end ge "+o.start},LocusZoom.Data.GeneSource.prototype.parseResponse=function(o,t,e,r){return{header:t.header,body:o.data}},LocusZoom.Data.GeneSource.SOURCE_NAME="GeneLZ",LocusZoom.createResolvedPromise=function(){var o=Q.defer();return o.resolve(Array.prototype.slice.call(arguments)),o.promise},LocusZoom.KnownDataSources=[LocusZoom.Data.AssociationSource,LocusZoom.Data.LDSource,LocusZoom.Data.GeneSource],LocusZoom.Data.Transformations=function(){var o={},t={neglog10:function(o){return-Math.log(o)/Math.LN10}},e=function(o){if(!o)return null;var e=t[o];if(e)return e;throw"transformation "+o+" not found"},r=function(o){return e(o)},n=function(o){for(var t,e=[],n=/\|([^\|]+)/g;null!=(t=n.exec(o));)e.push(t[1]);return 1==e.length?r(e[0]):e.length>1?function(o){for(var t=o,n=0;n<e.length;n++)t=r(e[n])(t);return t}:null};return o.get=function(o){return o&&"|"==o.substring(0,1)?n(o):r(o)},o.set=function(o,e){if("|"==o.substring(0,1))throw"transformation name should not start with a pipe";e?t[o]=e:delete t[o]},o.add=function(e,r){if(t.name)throw"transformation already exists with name: "+e;o.set(e,r)},o.list=function(){return Object.keys(t)},o}();
"use strict";LocusZoom.Instance=function(t,i,s,e){return this.initialized=!1,this.id=t,this.svg=null,this.panels={},this.remap_promises=[],this.layout=LocusZoom.mergeLayouts(s||{},LocusZoom.DefaultLayout),this.state=e||JSON.parse(JSON.stringify(LocusZoom.DefaultState)),this.lzd=new LocusZoom.Data.Requester(i),this.initializeLayout(),this},LocusZoom.Instance.prototype.initializeLayout=function(){this.setDimensions();var t;for(t in this.layout.panels)this.addPanel(t,this.layout.panels[t])},LocusZoom.Instance.prototype.setDimensions=function(t,i){return!isNaN(t)&&t>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width)),!isNaN(i)&&i>=0&&(this.layout.height=Math.max(Math.round(+i),this.layout.min_height)),null!=this.svg&&this.svg.attr("width",this.layout.width).attr("height",this.layout.height),this.initialized&&(this.ui.render(),this.stackPanels()),this},LocusZoom.Instance.prototype.addPanel=function(t,i){if("string"!=typeof t)throw"Invalid panel id passed to LocusZoom.Instance.prototype.addPanel()";if("undefined"!=typeof this.panels[t])throw"Cannot create panel with id ["+t+"]; panel with that id already exists";if("object"!=typeof i)throw"Invalid panel layout passed to LocusZoom.Instance.prototype.addPanel()";var s=new LocusZoom.Panel(t,i);return s.parent=this,this.panels[s.id]=s,this.stackPanels(),this.panels[s.id]},LocusZoom.Instance.prototype.stackPanels=function(){var t,i=[],s=[];for(t in this.panels)i.push(this.panels[t].layout.min_width),s.push(this.panels[t].layout.min_height);if(i.length&&(this.layout.min_width=Math.max.apply(null,i)),s.length&&(this.layout.min_height=s.reduce(function(t,i){return t+i})),this.layout.width<this.layout.min_width||this.layout.height<this.layout.min_height)return void this.setDimensions(Math.max(this.layout.width,this.layout.min_width),Math.max(this.layout.height,this.layout.min_height));var e=1/Object.keys(this.panels).length,a=this.layout.height*e,n=0;for(t in this.panels)this.panels[t].layout.proportional_height=e,this.panels[t].setOrigin(0,n*a),this.panels[t].setDimensions(this.layout.width,a),n++},LocusZoom.Instance.prototype.initialize=function(){var t=this.svg.append("g").attr("class","lz-mouse_guide").attr("id",this.id+".mouse_guide"),i=t.append("rect").attr("class","lz-mouse_guide-vertical").attr("x",-1),s=t.append("rect").attr("class","lz-mouse_guide-horizontal").attr("y",-1);this.mouse_guide={svg:t,vertical:i,horizontal:s};var e=this.svg.append("g").attr("class","lz-ui").attr("id",this.id+".ui").style("display","none");this.ui={svg:e,parent:this,is_resize_dragging:!1,show:function(){this.svg.style("display",null)},hide:function(){this.svg.style("display","none")},initialize:function(){this.resize_handle=this.svg.append("g").attr("id",this.parent.id+".ui.resize_handle"),this.resize_handle.append("path").attr("class","lz-ui-resize_handle").attr("d","M 0,16, L 16,0, L 16,16 Z");var t=d3.behavior.drag();t.on("dragstart",function(){this.resize_handle.select("path").attr("class","lz-ui-resize_handle_dragging"),this.is_resize_dragging=!0}.bind(this)),t.on("dragend",function(){this.resize_handle.select("path").attr("class","lz-ui-resize_handle"),this.is_resize_dragging=!1}.bind(this)),t.on("drag",function(){this.setDimensions(this.layout.width+d3.event.dx,this.layout.height+d3.event.dy)}.bind(this.parent)),this.resize_handle.call(t),this.render()},render:function(){this.resize_handle.attr("transform","translate("+(this.parent.layout.width-17)+", "+(this.parent.layout.height-17)+")")}},this.ui.initialize();var a=this.svg.append("g").attr("class","lz-curtain").style("display","none").attr("id",this.id+".curtain");this.curtain={svg:a,drop:function(t){this.svg.style("display",null),"undefined"!=typeof t&&(this.svg.select("text").selectAll("tspan").remove(),t.split("\n").forEach(function(t){this.svg.select("text").append("tspan").attr("x","1em").attr("dy","1.5em").text(t)}.bind(this)))},raise:function(){this.svg.style("display","none")}},this.curtain.svg.append("rect"),this.curtain.svg.append("text").attr("id",this.id+".curtain_text").attr("x","1em").attr("y","0em");for(var n in this.panels)this.panels[n].initialize();return this.svg.on("mouseover",function(){this.ui.is_resize_dragging||this.ui.show()}.bind(this)),this.svg.on("mouseout",function(){this.ui.is_resize_dragging||this.ui.hide(),this.mouse_guide.vertical.attr("x",-1),this.mouse_guide.horizontal.attr("y",-1)}.bind(this)),this.svg.on("mousemove",function(){var t=d3.mouse(this.svg.node());this.mouse_guide.vertical.attr("x",t[0]),this.mouse_guide.horizontal.attr("y",t[1])}.bind(this)),this.initialized=!0,this},LocusZoom.Instance.prototype.mapTo=function(t,i,s){this.state.chr=+t,this.state.start=+i,this.state.end=+s,this.remap_promises=[];for(var e in this.panels)this.remap_promises.push(this.panels[e].reMap());return Q.all(this.remap_promises)["catch"](function(t){console.log(t),this.curtain.drop(t)}.bind(this)).done(),this},LocusZoom.Instance.prototype.refresh=function(){this.mapTo(this.state.chr,this.state.start,this.state.end)};
"use strict";LocusZoom.Panel=function(t,a){return this.initialized=!1,this.id=t,this.parent=null,this.svg={},this.layout=LocusZoom.mergeLayouts(a||{},LocusZoom.Panel.DefaultLayout),this.data_layers={},this.data_layer_ids_by_z_index=[],this.data_promises=[],this.xExtent=null,this.y1Extent=null,this.y2Extent=null,this.getBaseId=function(){return this.parent.id+"."+this.id},this.initializeLayout(),this},LocusZoom.Panel.DefaultLayout={width:0,height:0,min_width:0,min_height:0,proportional_width:1,proportional_height:1,origin:{x:0,y:0},margin:{top:0,right:0,bottom:0,left:0},cliparea:{height:0,width:0,origin:{x:0,y:0}},axes:{x:{},y1:{},y2:{}}},LocusZoom.Panel.prototype.initializeLayout=function(){if(this.setDimensions(),this.setOrigin(),this.setMargin(),["x","y1","y2"].forEach(function(t){JSON.stringify(this.layout.axes[t])==JSON.stringify({})?this.layout.axes[t].render=!1:(this.layout.axes[t].render=!0,this.layout.axes[t].ticks=this.layout.axes[t].ticks||[],this.layout.axes[t].label=this.layout.axes[t].label||null,this.layout.axes[t].label_function=this.layout.axes[t].label_function||null,this.layout.axes[t].data_layer_id=this.layout.axes[t].data_layer_id||null)}.bind(this)),"object"==typeof this.layout.data_layers){var t;for(t in this.layout.data_layers)this.addDataLayer(t,this.layout.data_layers[t])}},LocusZoom.Panel.prototype.setDimensions=function(t,a){return!isNaN(t)&&t>=0&&(this.layout.width=Math.max(Math.round(+t),this.layout.min_width)),!isNaN(a)&&a>=0&&(this.layout.height=Math.max(Math.round(+a),this.layout.min_height)),this.layout.cliparea.width=this.layout.width-(this.layout.margin.left+this.layout.margin.right),this.layout.cliparea.height=this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),this.initialized&&this.render(),this},LocusZoom.Panel.prototype.setOrigin=function(t,a){return!isNaN(t)&&t>=0&&(this.layout.origin.x=Math.min(Math.max(Math.round(+t),0),this.parent.layout.width)),!isNaN(a)&&a>=0&&(this.layout.origin.y=Math.min(Math.max(Math.round(+a),0),this.parent.layout.height)),this.initialized&&this.render(),this},LocusZoom.Panel.prototype.setMargin=function(t,a,i,s){var e;return!isNaN(t)&&t>=0&&(this.layout.margin.top=Math.max(Math.round(+t),0)),!isNaN(a)&&a>=0&&(this.layout.margin.right=Math.max(Math.round(+a),0)),!isNaN(i)&&i>=0&&(this.layout.margin.bottom=Math.max(Math.round(+i),0)),!isNaN(s)&&s>=0&&(this.layout.margin.left=Math.max(Math.round(+s),0)),this.layout.margin.top+this.layout.margin.bottom>this.layout.height&&(e=Math.floor((this.layout.margin.top+this.layout.margin.bottom-this.layout.height)/2),this.layout.margin.top-=e,this.layout.margin.bottom-=e),this.layout.margin.left+this.layout.margin.right>this.layout.width&&(e=Math.floor((this.layout.margin.left+this.layout.margin.right-this.layout.width)/2),this.layout.margin.left-=e,this.layout.margin.right-=e),this.layout.cliparea.width=this.layout.width-(this.layout.margin.left+this.layout.margin.right),this.layout.cliparea.height=this.layout.height-(this.layout.margin.top+this.layout.margin.bottom),this.layout.cliparea.origin.x=this.layout.margin.left,this.layout.cliparea.origin.y=this.layout.margin.top,this.initialized&&this.render(),this},LocusZoom.Panel.prototype.initialize=function(){this.svg.container=this.parent.svg.insert("svg:g","#"+this.parent.id+"\\.ui").attr("id",this.getBaseId()+".panel_container");var t=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip");this.svg.clipRect=t.append("rect"),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".panel").attr("clip-path","url(#"+this.getBaseId()+".clip)");var a=this.svg.container.append("g").attr("id",this.getBaseId()+".curtain").attr("clip-path","url(#"+this.getBaseId()+".clip)").attr("class","lz-curtain").style("display","none");this.curtain={svg:a,drop:function(t){this.svg.style("display",null),"undefined"!=typeof t&&(this.svg.select("text").selectAll("tspan").remove(),t.split("\n").forEach(function(t){this.svg.select("text").append("tspan").attr("x","1em").attr("dy","1.5em").text(t)}.bind(this)))},raise:function(){this.svg.style("display","none")}},this.curtain.svg.append("rect"),this.curtain.svg.append("text").attr("id",this.id+".curtain_text").attr("x","1em").attr("y","0em"),this.svg.x_axis=this.svg.group.append("g").attr("class","lz-x lz-axis"),this.layout.axes.x.render&&(this.svg.x_axis_label=this.svg.x_axis.append("text").attr("class","lz-x lz-axis lz-label").attr("text-anchor","middle")),this.svg.y1_axis=this.svg.group.append("g").attr("class","lz-y lz-y1 lz-axis"),this.layout.axes.y1.render&&(this.svg.y1_axis_label=this.svg.y1_axis.append("text").attr("class","lz-y1 lz-axis lz-label").attr("text-anchor","middle")),this.svg.y2_axis=this.svg.group.append("g").attr("class","lz-y lz-y2 lz-axis"),this.layout.axes.y2.render&&(this.svg.y2_axis_label=this.svg.y2_axis.append("text").attr("class","lz-y2 lz-axis lz-label").attr("text-anchor","middle"));for(var i in this.data_layers)this.data_layers[i].initialize();return this.initialized=!0,this},LocusZoom.Panel.prototype.addDataLayer=function(t,a){if("string"!=typeof t)throw"Invalid data layer id passed to LocusZoom.Panel.prototype.addDataLayer()";if("object"!=typeof a)throw"Invalid data layer layout passed to LocusZoom.Panel.prototype.addDataLayer()";if("undefined"!=typeof this.data_layers[a.id])throw"Cannot create data layer with id ["+t+"]; data layer with that id already exists";if("string"!=typeof a.type)throw"Invalid data layer type in layout passed to LocusZoom.Panel.prototype.addDataLayer()";var i=LocusZoom.DataLayers.get(a.type,t,a);if(i.parent=this,this.data_layers[i.id]=i,this.data_layer_ids_by_z_index.push(i.id),a.x_axis?this.xExtent=this.data_layers[i.id].getAxisExtent("x"):this.xExtent=function(){return d3.extent([this.parent.state.start,this.parent.state.end])},a.y_axis){var s="y"+(1==a.y_axis.axis||2==a.y_axis.axis?a.y_axis.axis:1);this[s+"Extent"]=this.data_layers[i.id].getAxisExtent("y"),this.layout.axes[s].data_layer_id=i.id}return this.data_layers[i.id]},LocusZoom.Panel.prototype.reMap=function(){this.data_promises=[];for(var t in this.data_layers)this.data_promises.push(this.data_layers[t].reMap());return Q.all(this.data_promises).then(function(){this.render()}.bind(this))["catch"](function(t){console.log(t),this.curtain.drop(t)}.bind(this))},LocusZoom.Panel.prototype.render=function(){var t=function(t,a){var i="neither";if(t.axes[a].data_layer_id){var s=t.data_layers[t.axes[a].data_layer_id].y_axis;"number"==typeof s.floor&&(i="low"),"number"==typeof s.ceiling&&(i="high"),"number"==typeof s.floor&&"number"==typeof s.ceiling&&(i="both")}return i};this.svg.container.attr("transform","translate("+this.layout.origin.x+","+this.layout.origin.y+")"),this.svg.clipRect.attr("width",this.layout.width).attr("height",this.layout.height),"function"==typeof this.xExtent&&(this.x_extent=this.xExtent(),this.layout.axes.x.ticks=LocusZoom.prettyTicks(this.x_extent,"both",this.layout.cliparea.width/120),this.x_scale=d3.scale.linear().domain([this.x_extent[0],this.x_extent[1]]).range([0,this.layout.cliparea.width])),"function"==typeof this.y1Extent&&(this.y1_extent=this.y1Extent(),this.layout.axes.y1.ticks=LocusZoom.prettyTicks(this.y1_extent,t(this.layout,"y1")),this.y1_scale=d3.scale.linear().domain([this.layout.axes.y1.ticks[0],this.layout.axes.y1.ticks[this.layout.axes.y1.ticks.length-1]]).range([this.layout.cliparea.height,0])),"function"==typeof this.y2Extent&&(this.y2_extent=this.y2Extent(),this.layout.axes.y2.ticks=LocusZoom.prettyTicks(this.y2_extent,t(this.layout,"y2")),this.y2_scale=d3.scale.linear().domain([this.layout.axes.y2.ticks[0],this.layout.axes.y1.ticks[this.layout.axes.y2.ticks.length-1]]).range([this.layout.cliparea.height,0]));var a=function(t){return"function"==typeof this[t+"_scale"]&&!isNaN(this[t+"_scale"](0))}.bind(this);if(this.layout.axes.x.render&&a("x")&&(this.x_axis=d3.svg.axis().scale(this.x_scale).orient("bottom").tickValues(this.layout.axes.x.ticks).tickFormat(function(t){return LocusZoom.positionIntToString(t)}),this.svg.x_axis.attr("transform","translate("+this.layout.margin.left+","+(this.layout.height-this.layout.margin.bottom)+")").call(this.x_axis),this.layout.axes.x.label_function&&(this.layout.axes.x.label=LocusZoom.LabelFunctions.get(this.layout.axes.x.label_function,this.parent.state)),null!=this.layout.axes.x.label)){var i=this.layout.axes.x.label;"function"==typeof this.layout.axes.x.label&&(i=this.layout.axes.x.label()),this.svg.x_axis_label.attr("x",this.layout.cliparea.width/2).attr("y",.95*this.layout.margin.bottom).text(i)}if(this.layout.axes.y1.render&&a("y1")&&(this.y1_axis=d3.svg.axis().scale(this.y1_scale).orient("left").tickValues(this.layout.axes.y1.ticks),this.svg.y1_axis.attr("transform","translate("+this.layout.margin.left+","+this.layout.margin.top+")").call(this.y1_axis),this.layout.axes.y1.label_function&&(this.layout.axes.y1.label=LocusZoom.LabelFunctions.get(this.layout.axes.y1.label_function,this.parent.state)),null!=this.layout.axes.y1.label)){var s=this.layout.axes.y1.label;"function"==typeof this.layout.axes.y1.label&&(s=this.layout.axes.y1.label());var e=this.layout.margin.left*-.55,o=this.layout.cliparea.height/2;this.svg.y1_axis_label.attr("transform","rotate(-90 "+e+","+o+")").attr("x",e).attr("y",o).text(s)}if(this.layout.axes.y2.render&&a("y2")&&(this.y2_axis=d3.svg.axis().scale(this.y2_scale).orient("left").tickValues(this.layout.axes.y2.ticks),this.svg.y2_axis.attr("transform","translate("+(this.layout.width-this.layout.margin.right)+","+this.layout.margin.top+")").call(this.y2_axis),this.layout.axes.y2.label_function&&(this.layout.axes.y2.label=LocusZoom.LabelFunctions.get(this.layout.axes.y2.label_function,this.parent.state)),null!=this.layout.axes.y2.label)){var l=this.layout.axes.y2.label;"function"==typeof this.layout.axes.y2.label&&(l=this.layout.axes.y2.label());var h=.55*this.layout.margin.right,n=this.layout.cliparea.height/2;this.svg.y2_axis_label.attr("transform","rotate(-90 "+h+","+n+")").attr("x",h).attr("y",n).text(l)}return this.data_layer_ids_by_z_index.forEach(function(t){this.data_layers[t].draw().render()}.bind(this)),this};
"use strict";LocusZoom.DataLayer=function(t,a){return this.initialized=!1,this.id=t,this.parent=null,this.svg={},this.layout=LocusZoom.mergeLayouts(a||{},LocusZoom.DataLayer.DefaultLayout),this.data=[],this.metadata={},this.getBaseId=function(){return this.parent.parent.id+"."+this.parent.id+"."+this.id},this},LocusZoom.DataLayer.DefaultLayout={type:"",fields:[]},LocusZoom.DataLayer.prototype.getAxisExtent=function(t){var a=t+"_axis";return function(){var t=d3.extent(this.data,function(t){return+t[this.layout[a].field]}.bind(this)),i=t[1]-t[0];return isNaN(this.layout[a].lower_buffer)||(t[0]-=i*this.layout[a].lower_buffer),isNaN(this.layout[a].upper_buffer)||(t[1]+=i*this.layout[a].upper_buffer),isNaN(this.layout[a].floor)||(t[0]=Math.max(t[0],this.layout[a].floor)),isNaN(this.layout[a].ceiling)||(t[1]=Math.min(t[1],this.layout[a].ceiling)),t}.bind(this)},LocusZoom.DataLayer.prototype.initialize=function(){return this.svg.container=this.parent.svg.group.append("g").attr("id",this.getBaseId()+".data_layer_container"),this.svg.clipRect=this.svg.container.append("clipPath").attr("id",this.getBaseId()+".clip").append("rect"),this.svg.group=this.svg.container.append("g").attr("id",this.getBaseId()+".data_layer").attr("clip-path","url(#"+this.getBaseId()+".clip)"),this.initialized=!0,this},LocusZoom.DataLayer.prototype.draw=function(){return this.svg.container.attr("transform","translate("+this.parent.layout.cliparea.origin.x+","+this.parent.layout.cliparea.origin.y+")"),this.svg.clipRect.attr("width",this.parent.layout.cliparea.width).attr("height",this.parent.layout.cliparea.height),this},LocusZoom.DataLayer.prototype.reMap=function(){var t=this.parent.parent.lzd.getData(this.parent.parent.state,this.layout.fields);return t.then(function(t){this.data=t.body}.bind(this)),t};
"use strict";LocusZoom.LabelFunctions=function(){var t={},a={};return t.get=function(t,e){if(t){if(a[t])return"undefined"==typeof e?a[t]:a[t](e);throw"label function ["+t+"] not found"}return null},t.set=function(t,e){e?a[t]=e:delete a[t]},t.add=function(e,n){if(a[e])throw"label function already exists with name: "+e;t.set(e,n)},t.list=function(){return Object.keys(a)},t}(),LocusZoom.LabelFunctions.add("chromosome",function(t){return isNaN(+t.chr)?"Chromosome (Mb)":"Chromosome "+t.chr+" (Mb)"}),LocusZoom.ScaleFunctions=function(){var t={},a={};return t.get=function(t,e,n){if(t){if(a[t])return"undefined"==typeof e&&"undefined"==typeof n?a[t]:a[t](e,n);throw"scale function ["+t+"] not found"}return null},t.set=function(t,e){e?a[t]=e:delete a[t]},t.add=function(e,n){if(a[e])throw"scale function already exists with name: "+e;t.set(e,n)},t.list=function(){return Object.keys(a)},t}(),LocusZoom.ScaleFunctions.add("numerical_bin",function(t,a){var e=t.breaks,n=t.values;if(null==a||isNaN(+a))return t.null_value?t.null_value:n[0];var i=e.reduce(function(t,e){return t>+a||+a>=t&&e>+a?t:e});return n[e.indexOf(i)]}),LocusZoom.ScaleFunctions.add("categorical_bin",function(t,a){return-1!=t.categories.indexOf(a)?t.values[t.categories.indexOf(a)]:t.null_value?t.null_value:t.values[0]}),LocusZoom.DataLayers=function(){var t={},a={};return t.get=function(t,e,n){if(t){if(a[t]){if("undefined"==typeof e||"undefined"==typeof n)throw"id or layout argument missing for data layer ["+t+"]";return new a[t](e,n)}throw"data layer ["+t+"] not found"}return null},t.set=function(t,e){if(e){if("function"!=typeof e)throw"unable to set data layer ["+t+"], argument provided is not a function";a[t]=e,a[t].prototype=new LocusZoom.DataLayer}else delete a[t]},t.add=function(e,n){if(a[e])throw"data layer already exists with name: "+e;t.set(e,n)},t.list=function(){return Object.keys(a)},t}(),LocusZoom.DataLayers.add("scatter",function(t,a){return LocusZoom.DataLayer.apply(this,arguments),this.DefaultLayout={point_size:40,point_shape:"circle",color:"#888888",y_axis:{axis:1}},this.layout=LocusZoom.mergeLayouts(a,this.DefaultLayout),this.render=function(){this.svg.group.selectAll("*").remove();var t=this.svg.group.selectAll("path.lz-data_layer-scatter").data(this.data).enter().append("path").attr("class","lz-data_layer-scatter").attr("transform",function(t){var a=this.parent.x_scale(t[this.layout.x_axis.field]),e="y"+this.layout.y_axis.axis+"_scale",n=this.parent[e](t[this.layout.y_axis.field]);return"translate("+a+","+n+")"}.bind(this)).attr("d",d3.svg.symbol().size(this.layout.point_size).type(this.layout.point_shape)).style({cursor:"pointer"});if(-1!=this.layout.fields.indexOf("id")&&t.attr("id",function(t){return t.id}),this.layout.color)switch(typeof this.layout.color){case"string":t.attr("fill",this.layout.color);break;case"object":this.layout.color.scale_function&&this.layout.color.field&&t.attr("fill",function(t){return LocusZoom.ScaleFunctions.get(this.layout.color.scale_function,this.layout.color.parameters||{},t[this.layout.color.field])}.bind(this))}this.layout.point_label_field&&t.append("svg:title").text(function(t){return t[this.layout.point_label_field]}.bind(this))},this}),LocusZoom.DataLayers.add("genes",function(t,a){return LocusZoom.DataLayer.apply(this,arguments),this.DefaultLayout={label_font_size:12,label_exon_spacing:4,exon_height:16,track_vertical_spacing:10},this.getTrackHeight=function(){return this.layout.label_font_size+this.layout.label_exon_spacing+this.layout.exon_height+this.layout.track_vertical_spacing},this.layout=LocusZoom.mergeLayouts(a,this.DefaultLayout),this.metadata.tracks=1,this.metadata.gene_track_index={1:[]},this.metadata.horizontal_padding=4,this.assignTracks=function(){return this.getLabelWidth=function(t,a){var e=this.svg.group.append("text").attr("x",0).attr("y",0).attr("class","lz-gene lz-label").style("font-size",a).text(t+"→"),n=e.node().getBBox().width;return e.node().remove(),n},this.metadata.tracks=1,this.metadata.gene_track_index={1:[]},this.data.map(function(t,a){if(this.data[a].display_range={start:this.parent.x_scale(Math.max(t.start,this.parent.parent.state.start)),end:this.parent.x_scale(Math.min(t.end,this.parent.parent.state.end))},this.data[a].display_range.label_width=this.getLabelWidth(this.data[a].gene_name,this.layout.label_font_size),this.data[a].display_range.width=this.data[a].display_range.end-this.data[a].display_range.start,this.data[a].display_range.text_anchor="middle",this.data[a].display_range.width<this.data[a].display_range.label_width){if(t.start<this.parent.parent.state.start)this.data[a].display_range.end=this.data[a].display_range.start+this.data[a].display_range.label_width+this.metadata.horizontal_padding,this.data[a].display_range.text_anchor="start";else if(t.end>this.parent.parent.state.end)this.data[a].display_range.start=this.data[a].display_range.end-this.data[a].display_range.label_width-this.metadata.horizontal_padding,this.data[a].display_range.text_anchor="end";else{var e=(this.data[a].display_range.label_width-this.data[a].display_range.width)/2+this.metadata.horizontal_padding;this.data[a].display_range.start-e<this.parent.x_scale(this.parent.parent.state.start)?(this.data[a].display_range.start=this.parent.x_scale(this.parent.parent.state.start),this.data[a].display_range.end=this.data[a].display_range.start+this.data[a].display_range.label_width,this.data[a].display_range.text_anchor="start"):this.data[a].display_range.end+e>this.parent.x_scale(this.parent.parent.state.end)?(this.data[a].display_range.end=this.parent.x_scale(this.parent.parent.state.end),this.data[a].display_range.start=this.data[a].display_range.end-this.data[a].display_range.label_width,this.data[a].display_range.text_anchor="end"):(this.data[a].display_range.start-=e,this.data[a].display_range.end+=e)}this.data[a].display_range.width=this.data[a].display_range.end-this.data[a].display_range.start}this.data[a].display_domain={start:this.parent.x_scale.invert(this.data[a].display_range.start),end:this.parent.x_scale.invert(this.data[a].display_range.end)},this.data[a].display_domain.width=this.data[a].display_domain.end-this.data[a].display_domain.start,this.data[a].track=null;for(var n=1;null==this.data[a].track;){var i=!1;this.metadata.gene_track_index[n].map(function(t){if(!i){var a=Math.min(t.display_range.start,this.display_range.start),e=Math.max(t.display_range.end,this.display_range.end);e-a<t.display_range.width+this.display_range.width&&(i=!0)}}.bind(this.data[a])),i?(n++,n>this.metadata.tracks&&(this.metadata.tracks=n,this.metadata.gene_track_index[n]=[])):(this.data[a].track=n,this.metadata.gene_track_index[n].push(this.data[a]))}this.data[a].parent=this,this.data[a].transcripts.map(function(t,e){this.data[a].transcripts[e].parent=this.data[a],this.data[a].transcripts[e].exons.map(function(t,n){this.data[a].transcripts[e].exons[n].parent=this.data[a].transcripts[e]}.bind(this))}.bind(this))}.bind(this)),this},this.render=function(){this.assignTracks(),this.svg.group.selectAll("*").remove(),this.svg.group.selectAll("g.lz-gene").data(this.data).enter().append("g").attr("class","lz-gene").attr("id",function(t){return t.gene_name}).each(function(t){d3.select(this).selectAll("rect.lz-gene").filter(".lz-boundary").data([t]).enter().append("rect").attr("class","lz-gene lz-boundary").attr("id",function(t){return t.gene_name}).attr("x",function(t){return this.parent.x_scale(t.start)}.bind(t.parent)).attr("y",function(t){return(t.track-1)*this.parent.getTrackHeight()+this.parent.layout.label_font_size+this.parent.layout.label_exon_spacing+Math.max(this.parent.layout.exon_height,3)/2}.bind(t)).attr("width",function(t){return this.parent.x_scale(t.end)-this.parent.x_scale(t.start)}.bind(t.parent)).attr("height",1).attr("fill","#000099").style({cursor:"pointer"}).append("svg:title").text(function(t){return t.gene_name}),d3.select(this).selectAll("text.lz-gene").data([t]).enter().append("text").attr("class","lz-gene lz-label").attr("x",function(t){return"middle"==t.display_range.text_anchor?t.display_range.start+t.display_range.width/2:"start"==t.display_range.text_anchor?t.display_range.start:"end"==t.display_range.text_anchor?t.display_range.end:void 0}).attr("y",function(t){return(t.track-1)*this.parent.getTrackHeight()+this.parent.layout.label_font_size}.bind(t)).attr("text-anchor",function(t){return t.display_range.text_anchor}).style("font-size",t.parent.layout.label_font_size).text(function(t){return"+"==t.strand?t.gene_name+"→":"←"+t.gene_name}),d3.select(this).selectAll("g.lz-gene").filter(".lz-exons").data([t]).enter().append("g").attr("class","lz-gene lz-exons").each(function(t){d3.select(this).selectAll("rect.lz-gene").filter(".lz-exon").data(t.transcripts[0].exons).enter().append("rect").attr("class","lz-gene lz-exon").attr("id",function(t){return t.exon_id}).attr("x",function(t){return this.parent.x_scale(t.start)}.bind(t.parent)).attr("y",function(){return(this.track-1)*this.parent.getTrackHeight()+this.parent.layout.label_font_size+this.parent.layout.label_exon_spacing}.bind(t)).attr("width",function(t){return this.parent.x_scale(t.end)-this.parent.x_scale(t.start)}.bind(t.parent)).attr("height",function(){return this.parent.layout.exon_height}.bind(t)).attr("fill","#000099").style({cursor:"pointer"})})})},this});

        if (typeof define === "function" && define.amd){
            this.LocusZoom = LocusZoom, define(LocusZoom);
        } else if (typeof module === "object" && module.exports) {
            module.exports = LocusZoom;
        } else {
            this.LocusZoom = LocusZoom;
        }

    } catch (plugin_loading_error){
        console.log("LocusZoom Plugin error: " + plugin_loading_error);
    }

}();
console.warn("You are loading LocusZoom from GitHub. These files will be removed in the future; please see documentation for information about using an official CDN.");
